# Ch2 C语言基本概念

C语言的一些基本概念包括预处理指令、函数、变量和语句



本章内容

描述如何对一个C程序进行编译和链接

变量存储程序执行过程中可能会发生改变的数据

利用`scanf`函数吧数据读入变量的方法

常量的数据在程序执行过程中不会发生改变，用户可以对其命名

C语言的命名（标识符）规则

C程序的布局规范

## 2.1 编写一个简单的C程序

```c
To C, or not to C: that is the question.
```

***pun.c***

```c
#include <stdio.h>

int main(void)
{
  printf("To C, or not to C: that is the question.\n");
  return 0;
}
```

程序第一行

```c
#include <stdio.h>
```

是比不可少的，它“包含”了C语言标准输入/输出库的相关信息。程序的可执行代码都在`main`函数中，这个函数代表“主”程序。`main`函数中的第一行代码是用来显示期望信息的。`printf`函数来自标准输入/输出库，可以产生完美的格式化输出。代码`\n`告诉`printf`函数执行完消息后要进行换行操作。

第二行代码

```c
return 0;
```

表明程序终止时会向操作系统返回值0。

### 2.1.1 编译和链接

尽管`pun.c`程序十分简短，但是为了运行这个程序而包含的内容可能比想象的要多。首先，需要生成一个包含有上述程序代码名为`pun.c`的文件（使用任何文本编辑器都可以创建该文件）。文件的名字无关紧要，但是编译器通常要求带上文件的扩展名`.c`。

对于C程序来说，把程序转化为机器可以执行的形式通常包含下列3个步骤。

​	***预处理***。首先程序会被交给预***处理器***（preprocessor）。预处理器执行以`#`开头的命令（通常称为***指令***）。预处理器有点类似于编辑器，它可以给程序添加内容，也可以对程序进行修改。

​	***编译。***修改后的程序现在可以进入***编译器***（compiler）了。编译器会把程序翻译成机器指令（即***目标代码***）。然而，这样的程序还是不可以运行的。

​	***链接***。在最后一个步骤中，***连接器***（linker）把由编译器产生的目标代码和所需的其他附加代码整合在一起，这样才最终产生了完全可执行的程序。这些附加代码包括程序中用到的库函数（如`printf`函数）。

### 2.1.2 集成开发环境

***集成开发环境***（integrated development environment，IDE）是一个软件包，我们可以在其中编辑、编译、链接、执行甚至调试程序。组成集成开发环境的各个部分可以协调工作。例如，当编译器发现程序中有错误时，它会让编辑器把包含出错代码的行突出显示出来。

## 2.2 简单程序的一般形式

简单的C程序一般具有如下形式：

```c
directives

int main(void)
{
  statements
}
```

使用大括号来标出`main`函数的启始和结束。C语言使用`{`和`}`的方式非常类似于其他语言中`begin`和`end`的用法。

C语言极其依赖缩写词和特殊符号，这是C程序非常简洁（或者不客气地说含义模糊）的一个原因。

C程序依赖3个关键的语言特性：指令（在编译前修改程序的编辑命令）、函数（被命名的可执行代码块，如`main`函数）和语句（程序运行时执行的命令）。

### 2.2.1 指令

在编译C程序之前，预处理器会首先对其进行编辑。我们把预处理器执行的命令称为***指令***（directives）。

```c
#include <stdio.h>
```

这条指令说明，在编译前把`<stdio.h>`中的信息“包含”到程序中。`<stdio.h>`包含了关于C标准输入/输出库的信息。C程序拥有大量类似于`<stdio.h>`的***头***（header），每个头都包含一些标准库的内容。这段程序中包含`<stdio.h>`的原因是：C语言不同于其他的编程语言，它没有内置“读”和“写”命令。输入/输出功能由标准库中的函数实现。

所有指令都是以字符`#`开始的。这个字符可以把C程序中的指令和其他代码区分开来。指令默认只占一行，每条指令的结尾没有分号或其他特殊标记。

### 2.2.2 函数

***函数***（Functions）类似于其他编程语言中的“过程”或“子例程”，它们是用来构建程序的构建块。事实上，C程序就是函数的集合。函数分为两大类：一类是程序员编写的函数，另一类则是作为C语言实现的一部分提供的函数。我们把后者称为***库函数***（library function），因为它们属于一个由编译器提供的函数“库”。

在C语言中，函数仅仅是一系列组合在一起并且赋予了名字的语句。某些函数计算数值，某些函数不这么做。计算数值的函数用`return`语句来指定所“返回”的值。例如，对参数进行加1操作的函数可以执行语句

```c
return x + 1;
```

虽然一个C程序可以包含多个函数，但只有`main`函数是必须有的。`main`函数是非常特殊的：在执行程序时系统会自动调用`main`函数。

`main`前面的`int`表明该函数将返回一个整数值。圆括号中的`void`表明`main`函数没有参数。语句

```c
return 0;
```

有两个作用：一是使`main`函数终止（从而结束程序），二是指出`main`函数的返回值是0。

### 2.2.3 语句

***语句***（statement）是程序运行时执行的命令。

C语言规定每条语句都要以分号结尾。（就像任何好的规则一样，这条规则也有一个例外：复合语句就不以分号结尾。）由于语句可以连续占用多行，有时很难确定它的结束位置，因此用分号来向编译器显示语句的结束位置。但指令通常只占一行，因此不需要用分号结尾。

### 2.2.4 显示字符串

***字符串字面量***——用一对双引号包围的一系列字符。当用`printf`函数显示字符串字面量时，最外层的双引号不会出现。

为了让`printf`跳转到下一行，必须在要显示的字符串中包含`\n`（换行符）。

例如，为了显示下列信息：

```c
Brevity is the soul of wit.
  --Shakespeare
```

可以这样写：

```c
printf("Brevity is the soul of wit.\n  --Shakespeare\n");
```



## 2.3 注释

每一个程序都应该包含识别信息，即程序名、编写日期、作者、程序的用途以及其他相关信息。C语言把这类信息放在注释（comment）中。符号`/*`标记注释的开始，而符号`*/`则标记注释的结束。例如：

```c
/* This is a comment */
```

注释几乎可以出现在程序的任何位置上。它既可以单独占行也可以和其他程序文本出现在同一行中

注释还可以占用多行。一旦遇到符号`/*`，那么编译器读入（并且忽略）随后的内容直到遇到符号`*/`为止。



（C99）提供了另一种类型的注释，以`//`(两个相邻的斜杠）开始：

```c
// This is a comment
```

新的注释风格有两个主要优点：首先，因为注释会在行末自动终止，所以不会出现未终止的注释意外吞噬部分程序的情况；其次，因为每行前面都必须有`//`，所以多行的注释更加醒目。

## 2.4 变量和赋值

在程序执行过程中有一种临时存储数据的方法，C语言中的这类存储单元被称为***变量***（variable）

### 2.4.1 类型

每一个变量都必须有一个***类型***（type）。类型用来说明变量所存储的数据的种类。C语言拥有广泛多样的类型。由于类型会影响变量的存储方式以及允许对变量进行的操作，所以选择合适的类型是非常关键的。

### 2.4.2 声明

在使用变量之前必须对其***声明***（为编译器所做的描述）。为了声明变量，首先要指定变量的类型，然后说明变量的名字。例如，我们可能这样声明变量`height`和`profit`：

```c
int height;
float profit;
```

如果几个变量具有相同的类型，就可以把它们的声明合并：

```c
int height, length, width, volume;
float profit, loss;
```

### 2.4.3 赋值

变量通过***赋值***（assignment）的方式获得值。例如，语句：

```c
height = 8;
length = 12;
width = 10; //8、12、和10称为常量（constant）
```

变量在赋值或以其他方式使用之前必须先声明。

```c
int height;
height = 8;
```

赋值给`float`型变量的常量通常都带小数点。例如，如果`profit`是一个`float`型的变量，可能会这样对其赋值：

```c
profit = 2150.48;
```

当我们把一个包含小数点的常量赋值给`float`型变量时，最好在该常量后面加一个字母`f`（代表`float`)：

```c
profit = 2150.48f;
```

通常情况下，赋值运算的右侧可以是一个含有常量、变量和运算符的公式（在C语言的术语中称为***表达式***）。

```c
height = 8;
length = 12;
width = 10;
volume = height * length * width; /* volume is now 960 */
```

### 2.4.4 显示变量的值

用`printf`可以显示出变量的值。

```c
printf("Height: %d\n", height); //占位符%d用来指明在显示过程中变量height的值的显示位置
```

C语言没有限制调用一次`printf`可以显示的变量的数量。为了同时显示变量`height`和变量`length`的值，可以使用下面的`printf`调用语句：

```c
printf("Height: %d Length: %d\n", height, length);
```

### 2.4.5 初始化

当程序开始执行时，某些变量会被自动设置为零，而大多数变量则不会。没有默认值并且尚未在程序中被赋值的变量是***未初始化的***（uninitialized）。

例如，可以在一步操作中声明变量`height`并同时对其进行初始化：

```c
int height = 8;
```

按照C语言的术语，数值8是一个***初始化式***（initializer）。

### 2.4.6 显示表达式的值

`printf`的功能不局限于显示变量中存储的数，它可以显示任意数值表达式的值。例如语句

```c
volume = height * length * width;
printf("%d\n", volume);
```

可以用以下形式代替：

```c
printf("%d\n", height * length * width);
```

`printf`显示表达式的能力说明了C语言的一个通用原则：在任何需要数值的地方，都可以使用具有相同类型的表达式。

## 2.5 读入输入

`scanf`函数和`printf`函数都需要使用***格式串***（format string）来指定输入或输出数据的形式。

为了读入一个`int`值，可以使用下面的`scanf`函数调用：

```c
scanf("%d", &i);	/* reads an integer; stores into i */
```

## 2.6 定义常量的名字

当程序含有常量时，建议给这些常量命名。可以采用成为***宏定义***（macro definition）的特性给常量命名：

```c
#define INCHES_PER_POUND 166
```

还可以利用宏来定义表达式

```c
#define RECIPROCAL_OF_PI (1.0f / 3.14159f)
```

当宏包含运算符时，必须用括号把表达式括起来。

## 2.7 标识符

在编写程序时，需要对变量、函数、宏和其他实体进行命名。这些名字成为***标识符***（identifier）。在C语言中，标识符可以含有字母、数字和下划线，但是必须以字母或者下划线开头。

C语言区分大小写，也就是说，在标识符中C语言区别大写字母和小写字母。

**关键字**

|  |      |  |     |
| :------: | :------: | :-------: | :---------: |
|   auto   |   enum   | restrict* |  unsigned   |
|  break   |  extern  |  return   |    void     |
|   case   |  float   |   short   |  volatile   |
|   char   |   for    |  signed   |    while    |
|  const   |   goto   |  sizeof   |   _Bool*    |
| continue |    if    |  static   |  _Complex*  |
| default  | inline*  |  struct   | _Imaginary* |
|    do    |   int    |  switch   |             |
|  double  |   long   |  typedef  |             |
|   else   | register |   union   |             |
||
*仅C99有

## 2.8 C程序的书写规范

我们可以把C程序看成是一连串***记号***（token），即许多在不改变意思的基础上无法再分割的字符组。标识符和关键字都是记号。像`+`和`-`这样的运算符、逗号和分号这样的标点符号以及字符串字面量，也都是记号。



语句可以分开放在任意多行内。例如，下面的语句非常长，很难将它压缩在一行内。

```c
printf("Dimensional weight (pounds): %d\n",
      (volume + INCHES_PER_POUND - 1) / INCHES_PER_POUND);
```

记号间的空格使我们更容易区分记号。基于这个原因，通常会在每个运算符的前后都放上一个空格：

```c
volume = height * length * width;
```

缩进有助于轻松识别程序嵌套。例如，为了清晰地表示出声明和语句都嵌套在`main`函数中，应该对它们进行缩进。

空行可以把程序划分成逻辑单元，从而使读者更容易辨别程序的结构。就像没有章节的书一样，没有空行的程序很难阅读。


