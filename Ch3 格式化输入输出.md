# Ch3 格式化输入/输出

本章内容

`printf`函数

`scanf`函数

## 3.1 `printf`函数

`printf`函数被设计用来显示***格式串***（format string）的内容，并且在该串中的指定位置插入可能的值。调用`printf`函数时必须提供格式串，格式串后面的参数是需要在显示时插入到该串中的值：

```c 
printf(格式串，表达式1，表达式2，...);
```

显示的值可以是常量、变量或者更加复杂的表达式。调用`printf`函数一次可以打印的值的个数没有限制。

格式串包含普通字符和***转换说明***（conversion specification），其中转换说明以字符`%`开头。转换说明是用来表示打印过程中待填充的值的占位符。

### 3.1.1 转换说明

转换说明给程序员提供了大量对输出格式的控制方法。

转换说明可以用`%m.pX`格式和`%-m.pX`格式，这里的`m`和`p`都是整数常量，而`X`是字母。`m`和`p`都是可选的。如果省略`p`，`m`和`p`之间的小数点也要去掉。

***最小字段宽度***（minimum field width）`m`指定了要显示的最小字符数量。如果要显示的数值所需的字符数少于`m`，那么值在字段内是右对齐的。（换句话说，在值前面放置额外的空格。）如果要显示的值所需的字符数多于`m`，那么字段宽度会自动扩展为所需的尺寸。在`m`前放上一个负号会导致左对齐。

***精度***（precision）`p`依赖于***转换说明符***（conversion specifier）`X`的选择。`X`表明在显示数值前需要对其进行哪种转换。对数值来说最常用的转换说明符有以下几个。

`d`——表示十进制（基数为10）形式的整数。`p`指明了待显示的数字的最少个数（必要时在数前加上额外的零）；如果省略`p`，则默认它的值为1。

`e`——表示指数（科学计数法）形式的浮点数。`p`指明了小数点后应该出现的数字的个数（默认值为6）。如果`p`为0，则不显示小数点。

`f`——表示“定点十进制”形式的浮点数，没有指数。`p`的含义与在说明符`e`中的一样。

`g`——表示指数形式或者定点十进制形式的浮点数，形式的选择根据数的大小决定。`p`说明可以显示的有效数字（没有小数点后的数字）的最大数量。与转换说明符`f`不同，`g`的转换符不显示尾随的零。此外，如果要显示的数值没有小数点后的数字，`g`就不会显示小数点。

### 3.1.2 转义序列

格式串中常用的代码`\n`被称为***转义序列***（escape sequence）。转义序列使字符串包含一些特殊字符而不会使编译器引发问题，这些字符包含非打印的（控制）字符和对编译器有特殊含义的字符（如`"`)。

## 3.2 `scanf`函数

`scanf`函数根据特定的格式读取输入，`scanf`函数的格式串也可以包含普通字符和转义说明两部分。

```c
int i, j;
float x, y;

scanf("%d%d%f%f", &i, &j, &x, &y);
```

### 3.2.1 `scanf`函数的工作方法

`scanf`函数本质上是一种“模式匹配”函数，试图把输入的字符组与转换说明相匹配。

像`printf`函数一样，`scanf`函数是由格式串控制的。调用时，`scanf`函数从左边开始处理字符串中的信息。对于格式串中的每一个转换说明，`scanf`函数读入数据项，并且在遇到不可能属于此项的字符时停止。如果读入数据项成功，那么`scanf`函数会继续处理格式串的剩余部分；如果某一项不能成功读入，那么`scanf`函数将不再查看格式串的剩余部分（或者余下的输入数据）而立即返回。

在寻找数的起始位置时，`scanf`函数会忽略***空白字符***（white-space character，包括空格符、水平和垂直制表符、换页符和换行符）。因此，我们可以把数字放在同一行或者分散在几行内输入。

在要求读入整数时，`scanf`函数首先寻找正号或负号，然后读取数字直接读到一个非数字时才停止。当要求读入浮点数时，`scanf`函数会寻找一个正号或负号（可选），随后是一串数字（可能含有小数点），再后是一个指数（可选）。指数由字母e（或者字母E）、可选的符号和一个或多个数字构成。在用于`scanf`函数时，转换说明`%d`、`%f`和`%g`是可以互换的，这3种转换说明在识别浮点数方面都遵循相同的规则。

当`scanf`函数遇到一个不可能属于当前项的字符时，它会把此字符“放回原处”，以便在扫描下一个输入项或者下一次调用`scanf`函数时再次读入。

### 3.2.2 格式串中的普通字符

通过编写含有普通字符和转换说明的格式串能更进一步地理解模式匹配的概念。处理格式串中的普通字符时，`scanf`函数采取的动作依赖于这个字符是否为空白字符。

**空白字符**。当在格式串中遇到一个或多个连续的空白字符时，`scanf`函数从输入中重复读空白字符直到遇到一个非空白字符（把该字符”放回原处“）为止。格式串中空白字符的数量无关紧要，格式串中的一个空白字符可以与输入中任意数量的空白字符相匹配。（顺带提一下，在格式串中包含空白字符并不意味着输入中必须包含空白字符。格式串中的一个空白字符可以与输入中任意数量多空白字符相匹配，包括零个。）

**其他字符**。当在格式串中遇到非空字符时，`scanf`函数把它与下一个输入字符进行比较。如果两个字符相匹配，那么`scanf`函数会放弃输入字符而继续处理格式串。如果两个字符不匹配，那么`scanf`函数会把不匹配的字符放回输入中，然后异常退出，而不进一步处理格式串或者从输入中读取字符。

### 3.2.3 易混淆的`printf`函数和`scanf`函数

一个常见的错误就是：在`printf`函数调用时在变量前面放置`&`。

在寻找数据项时，`scanf`函数通常会跳过空白字符。所以除了转换说明，格式串常常不需要包含字符。假设`scanf`格式串应该类似于`printf`格式串是另一个常见错误，这种不正确的假定可能引发`scanf`函数行为异常。
